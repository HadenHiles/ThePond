;(function($,_,undefined){"use strict";ips.controller.register('core.admin.customization.editorToolbars',{initialize:function(){this.on('click','[data-buttonKey]',this.openPreferences);this.on('click','[data-action="addToolbar"]',this.addToolbar);this.on('click','[data-action="addSep"]',this.addSep);this.on(document,'editorWidgetInitialized',this.setUpEditor);this.setup();},setup:function(){var self=this;self.scope.find('[data-role="dummyToolbar"]').sortable({connectWith:'[data-role="dummyToolbar"]',update:_.bind(self._saveToolbars,self),appendTo:document.body});},setUpEditor:function(){this._setUpCKEditor();},openPreferences:function(e){var elem=$(e.currentTarget);var title=elem.attr('title');window.location=this.scope.attr('data-url')+'&do=permissions&button='+elem.attr('data-buttonKey')+'&title='+title;},addToolbar:function(e){e.preventDefault();var elem=$(e.currentTarget);var list=$('<ul class="dummy_toolbar clearfix" data-role="dummyToolbar" style="min-height:40px" />');list.sortable({connectWith:'[data-role="dummyToolbar"]',update:_.bind(this._saveToolbars,this),appendTo:document.body});this.scope.find('[data-role="dummyToolbar"]').sortable('option','connectWith',list);this.scope.find('#'+elem.attr('data-deviceKey')+'_editor_toolbars').append(list);},addSep:function(e){e.preventDefault();var elem=$(e.currentTarget);var list=$('#'+elem.attr('data-deviceKey')+'_editor_toolbars').children().last();list.append($('<li><span class="cke_toolbar_separator"></span></li>'));list.sortable({connectWith:'[data-role="dummyToolbar"]',update:_.bind(this._saveToolbars,this),appendTo:document.body});},_setUpCKEditor:function(){var self=this;var instance=null;for(var i in CKEDITOR.instances){instance=CKEDITOR.instances[i];}
var items=CKEDITOR.ui(instance).items;for(var i in items){var elem=null;switch(items[i].type){case'button':case'panelbutton':if(!$('.'+instance.id).find('.cke_button__'+items[i].name).length){var button=new CKEDITOR.ui.button(items[i]);var output=[];button.render(instance,output);elem=$(output.join(''));}else{elem=$('.'+instance.id).find('.cke_button__'+items[i].name);}
break;case'richcombo':elem=$('.'+instance.id).find('.cke_combo__'+items[i].name);break;case'separator':break;}
if(elem!==null){self.scope.find('[data-role="dummyEditor"]').each(function(){var deviceKey=$(this).attr('data-deviceKey');var elemClone=elem.clone().attr('data-buttonKey',i);elemClone.removeAttr('onclick').children().removeAttr('onclick');if(self.scope.find('#'+deviceKey+'_editorButton_'+i).length){self.scope.find('#'+deviceKey+'_editorButton_'+i).append(elemClone);}else{self.scope.find('#'+deviceKey+'_editor_unusedButtons').append($('<li/>').attr('id',deviceKey+'_editorButton_'+i).append(elemClone));}});}}},_saveToolbars:function(){var _save={desktop:[],tablet:[],phone:[]};this.scope.find('[data-role="devicePanel"]').each(function(){var deviceKey=$(this).attr('data-deviceKey');var save=[];var i=1;$(this).find('[data-role="dummyToolbar"]').each(function(){var _id='row_'+i;i++;if(!$(this).hasClass('editor_unusedButtons')){var toolbar=[];$(this).children().each(function(){var buttonKey=null;if($(this).attr('id')){buttonKey=$(this).attr('id').substr(14+deviceKey.length);}else{buttonKey='-';}
toolbar.push(buttonKey);});save.push(toolbar);}});_save[deviceKey]=save;});ips.getAjax()(this.scope.attr('data-url')+'&do=save',{type:'post',data:{toolbars:JSON.stringify(_save),}});}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.admin.customization.emoticons',{initialize:function(){this.on('blur','[data-role="emoticonTyped"]',this.checkTypedValue);this.on('submit',this.submit);this.setup();},setup:function(){this.scope.find('[data-role="setList"]').sortable({update:_.bind(this._saveSetOrder,this)});this.scope.find('[data-role="emoticonsList"]').sortable({connectWith:this.scope.find('[data-role="emoticonsList"]'),handle:'[data-role="dragHandle"]',update:_.bind(this._saveOrder,this)});},submit:function(e){if(!window.JSON){return;}
var formElements=this.scope.find(':input:enabled');var output=ips.utils.form.serializeAsObject(formElements);var newInput=$('<input />').attr('type','hidden').attr('name','emoticons_squashed');Debug.log("Before encoding, emoticon data is:");Debug.log(output);output=JSON.stringify(output);this.scope.prepend(newInput.val(output));formElements.prop('disabled',true);},checkTypedValue:function(e){var elem=$(e.currentTarget);var val=elem.val();elem.val(val.replace(/\s/g,''));if(val.match(/\s/)){ips.ui.alert.show({type:'alert',message:ips.getString('emoticon_no_spaces'),icon:'warn'});}},_saveSetOrder:function(){var setOrder=[];this.scope.find('[data-emoticonSet]').each(function(){setOrder.push($(this).attr('data-emoticonSet'));});ips.getAjax()(this.scope.attr('action'),{type:'post',data:{setOrder:setOrder}});},_saveOrder:function(e,ui){var output={};var item=ui.item;var group=ui.item.closest('[data-emoticonSet]').attr('data-emoticonSet');ui.item.find('.cEmoticons_input > input[type="hidden"]').val(group);this.scope.find('[data-emoticonGroup]').each(function(){var itemOrder=[];$(this).find('[data-emoticonID]').each(function(){itemOrder.push(parseInt($(this).attr('data-emoticonID')));});output[$(this).attr('data-emoticonGroup')]=itemOrder;});ips.getAjax()(this.scope.attr('action'),{type:'post',data:output});}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.admin.customization.themes',{initialize:function(){this.on('click',this.revertSetting);},revertSetting:function(e){var self=this;e.preventDefault();ips.ui.alert.show({type:'confirm',message:ips.getString('theme_revert_setting'),icon:'fa fa-question',buttons:{ok:ips.getString('ok'),cancel:ips.getString('cancel')},callbacks:{ok:function(){ips.getAjax()(self.scope.attr('href')+'&wasConfirmed=1').done(function(response){var obj=$('#theme_setting_'+self.scope.attr('data-ipsThemeSetting')+' input[name^=core_theme_setting_title_]');obj.val(response.value);obj.focus().blur();self.scope.hide();});},}});}});}(jQuery,_));;