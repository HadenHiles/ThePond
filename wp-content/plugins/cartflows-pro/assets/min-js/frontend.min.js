!function(d){function i(e){e._nonce=cartflows_offer[e.action+"_nonce"],d.ajax({url:cartflows.ajax_url,data:e,dataType:"json",type:"POST",success:function(e){var t=e.message,o="wcf-payment-"+e.status;d("body").trigger("wcf-update-msg",[t,o]),setTimeout(function(){window.location.href=e.redirect},500)}})}d(document).ready(function(r){r("body").on("wcf-show-loader",function(e,t){"no"===t&&(jQuery(".wcf-note-yes").hide(),jQuery(".wcf-note-no").show()),r(".wcf-loader-bg").addClass("show")}),r("body").on("wcf-hide-loader",function(e){r(".wcf-loader-bg").removeClass("show")}),r("body").on("wcf-update-msg",function(e,t,o){r(".wcf-order-msg .wcf-process-msg").text(t).addClass(o)}),d('a[href*="wcf-up-offer"], a[href*="wcf-down-offer"]').each(function(e){var t=d(this),o=t.attr("href");-1!==o.indexOf("wcf-up-offer-yes")&&t.attr("id","wcf-upsell-offer"),-1!==o.indexOf("wcf-down-offer-yes")&&t.attr("id","wcf-downsell-offer")}),d(document).on("click",'a[href*="wcf-up-offer"], a[href*="wcf-down-offer"]',function(e){e.preventDefault();var t=d(this).attr("href"),o="yes",r="upsell",a=cartflows_offer.step_id,f=cartflows_offer.product_id,n=cartflows_offer.order_id,c=cartflows_offer.order_key;if(-1!==t.indexOf("wcf-up-offer")&&(r="upsell",o=-1!==t.indexOf("wcf-up-offer-yes")?"yes":"no"),-1!==t.indexOf("wcf-down-offer")&&(r="downsell",o=-1!==t.indexOf("wcf-down-offer-yes")?"yes":"no"),"yes"!==cartflows_offer.skip_offer||"yes"!==o){d("body").trigger("wcf-show-loader",o),action="yes"===o?"wcf_"+r+"_accepted":"wcf_"+r+"_rejected";var s={action:"",offer_action:o,offer_type:r,step_id:a,product_id:f,order_id:n,order_key:c,stripe_sca_payment:!1,stripe_intent_id:"",_nonce:""};return"stripe"===cartflows_offer.payment_method&&"yes"===o?(s.action="wcf_stripe_sca_check",s._nonce=cartflows_offer.wcf_stripe_sca_check_nonce,d.ajax({url:cartflows.ajax_url,data:s,dataType:"json",type:"POST",success:function(e){e.hasOwnProperty("intent_secret")?Stripe(e.stripe_pk).handleCardPayment(e.intent_secret).then(function(e){if(e.error)throw e.error;"requires_capture"!==e.paymentIntent.status&&"succeeded"!==e.paymentIntent.status||(s.action=action,s.stripe_sca_payment=!0,s.stripe_intent_id=e.paymentIntent.id,i(s))}).catch(function(e){window.location.reload()}):(s.action=action,i(s))}})):(s.action=action,i(s)),!1}}),d(document).on("click",".wcf-upsell-offer, .wcf-downsell-offer",function(e){e.preventDefault();var t=d(this),o=t.data("action"),r="upsell",a=t.data("step"),f=t.data("product"),n=t.data("order"),c=t.data("order_key");if(!t.hasClass("cartflows-skip")||"yes"!==o)return d("body").trigger("wcf-show-loader",o),t.hasClass("wcf-downsell-offer")&&(r="downsell"),action="yes"===o?"wcf_"+r+"_accepted":"wcf_"+r+"_rejected",d.ajax({url:cartflows.ajax_url,data:{action:action,offer_action:o,step_id:a,product_id:f,order_id:n,order_key:c},dataType:"json",type:"POST",success:function(e){var t=e.message,o="wcf-payment-"+e.status;d("body").trigger("wcf-update-msg",[t,o]),setTimeout(function(){window.location.href=e.redirect},500)}}),!1}),jQuery(document).ajaxComplete(function(e,t,o){if(t.hasOwnProperty("responseJSON")){var r=t.responseJSON.hasOwnProperty("fragments")?t.responseJSON.fragments:null;r&&r.hasOwnProperty("added_to_cart_data")&&fbq("track","AddToCart",r.added_to_cart_data.added_to_cart)}})})}(jQuery);