jQuery(document).ready(function(l){if(!(jQuery("#wcf-pre-checkout-offer-modal").length<1)){var o="";jQuery("form.checkout").on("checkout_place_order.wcf_pre_checkout",function(e){if("add"===jQuery(".wcf-pre-checkout-offer-action").val())return setTimeout(function(){!function(e){var n=jQuery("form.checkout").find('input[name="payment_method"]:checked').val();o=n,jQuery(".wcf_validation_error").remove(),jQuery("form.checkout").addClass("loader").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),l.ajax({url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","wcf_validate_form"),data:l("form.checkout").serialize(),dataType:"json",type:"POST",success:function(c){try{if(jQuery("form.checkout").removeClass("loader").unblock(),"success"!=c.result)throw"failure"===c.result?"Result failure":"Invalid response";if("authorize_net_cim_credit_card"===n)var e="yes";else{var o=jQuery("form.checkout").triggerHandler("checkout_place_order_"+n);e=null==o?"yes":null!=o&&1==o?"yes":"no"}if("yes"==e){var r=jQuery("#billing_first_name").val(),t=jQuery(".wcf-pre-checkout-offer-wrapper .wcf-content-modal-title h1").text(),f=t.match(/{([^}]+)}/);if(null!=f&&0!=r.length){if("first_name"===f[1])var a=t.replace(/{(.*?)}/,'<span class="wcf_first_name"></span>');else a=t.replace(/{(.*?)}/,"");l(".wcf-pre-checkout-offer-wrapper .wcf-content-modal-title h1").html(a),l(".wcf_first_name").text(r)}l(".wcf-pre-checkout-offer-wrapper").addClass("open"),l("html").addClass("wcf-pre-checkout-offer-open"),l(".wcf-pre-checkout-offer-action").val(""),setTimeout(function(){s()},100)}}catch(e){if(c.messages){jQuery("form.checkout").prepend('<div class="wcf_validation_error">'+c.messages+"</div>"),jQuery("form.checkout").removeClass("processing").unblock(),jQuery("form.checkout").find(".input-text, select, input:checkbox").trigger("validate").blur();var u=l(".wcf_validation_error");u.length||(u=l(".form.checkout")),l.scroll_to_notices(u)}}}})}()},100),!1}),l("body").on("click",".wcf-pre-checkout-offer-btn",function(e){e.preventDefault(),$checkoutForm=l(".wcf-pre-checkout-offer-btn").find("form.checkout");var c=l("._wcf_checkout_id").val();""!=c&&(l(".wcf-pre-checkout-offer-btn").html(cartflows.add_to_cart_text),l.ajax({url:cartflows.ajax_url,data:{action:"wcf_add_to_cart",product_quantity:1,checkout_id:c},dataType:"json",type:"POST",success:function(c){jQuery("form.checkout").off("checkout_place_order.wcf_pre_checkout"),"authorize_net_cim_credit_card"===o?(l("body").trigger("update_checkout",{update_shipping_method:!1}),l(document.body).on("updated_checkout.wcf_pre_checkout",function(e){l(".wcf-pre-checkout-offer-action").val(""),l(".wcf-pre-checkout-offer-btn").html(c.message),l(".wcf-pre-checkout-offer-wrapper").removeClass("open"),l("html").removeClass("wcf-pre-checkout-offer-open"),l("form.checkout").submit(),l(document.body).off("updated_checkout.wcf_pre_checkout")})):(l(".wcf-pre-checkout-offer-action").val(""),l(".wcf-pre-checkout-offer-btn").html(c.message),setTimeout(function(){l(".wcf-pre-checkout-offer-wrapper").removeClass("open"),l("html").removeClass("wcf-pre-checkout-offer-open"),l("form.checkout").submit()},600))}}))}),l("body").on("click",".wcf-pre-checkout-skip",function(){jQuery("form.checkout").off("checkout_place_order.wcf_pre_checkout"),l(".wcf-pre-checkout-offer-action").val(""),l(".wcf-pre-checkout-offer-wrapper").removeClass("open"),l("html").removeClass("wcf-pre-checkout-offer-open"),l("form.checkout").submit()}),l(window).resize(function(){s()});var s=function(){l(window).height()<l("#wcf-pre-checkout-offer-modal").height()?l("html").removeClass("wcf-pre-checkout-screen-size"):l("html").addClass("wcf-pre-checkout-screen-size")}}});