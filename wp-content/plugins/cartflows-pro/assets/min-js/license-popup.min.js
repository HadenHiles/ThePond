!function(i){CartFlowsProLicense={init:function(){this._check_popup(),this._bind()},_check_popup:function(){var e=CartFlowsProLicense;(e._getUrlParameter("cartflows-license-popup")||"")&&"Deactivated"==CartFlowsProLicenseVars.activation_status&&e._open_popup()},_bind:function(){i(document).on("click",".cartflows-license-popup-open-button",CartFlowsProLicense._export_button_click),i(document).on("click",".cartflows-close-popup-button",CartFlowsProLicense._close_popup),i(document).on("click","#cartflows-license-popup-overlay",CartFlowsProLicense._close_popup),i(document).on("click",".cartflows-activate-license",CartFlowsProLicense._activate_license),i(document).on("click",".cartflows-deactivate-license",CartFlowsProLicense._deactivate_license)},_log:function(e){(new Date).toLocaleTimeString()},_export_button_click:function(e){e.preventDefault(),CartFlowsProLicense._open_popup()},_open_popup:function(){var e=i("#cartflows-license-popup-overlay, #cartflows-license-popup"),t=i("#cartflows-license-popup").attr("data-license-key")||"",a=e.find(".contents");"Activated"==t?a.html(wp.template("cartflows-deactivate-license")):a.html(wp.template("cartflows-activate-license")),e.show()},_close_popup:function(){var e=i("#cartflows-license-popup-overlay, #cartflows-license-popup");e.hasClass("validating")&&!confirm("WARNING! License request not complete!!\n\nPlease wait for a moment until complete the license request.")||e.hide()},_activate_license:function(e){e.preventDefault();CartFlowsProLicense;var n=i(this),o=i("#cartflows-license-popup"),c=o.find(".contents"),s=i(".cartflows-license-popup-open-button"),l=o.find(".license_key").val()||"";l.length&&(n.hasClass("disabled")||n.hasClass("validating")||(o.addClass("validating"),n.find(".text").text("Validating.."),c.find(".notice").length&&c.find(".notice").remove(),n.find(".cartflows-processing").addClass("is-active"),i.ajax({url:ajaxurl,type:"POST",data:{action:"cartflows_activate_license",license_key:l}}).done(function(e,t,a){if(o.removeClass("validating"),n.find(".cartflows-processing").removeClass("is-active"),e.success)s.removeClass("active").addClass("inactive").text("Deactivate License"),n.find(".text").text("Successfully Activated! Reloading.."),o.attr("data-license-key",l),setTimeout(function(){location.reload()},2500),o.find("input").addClass("disabled").attr("readonly","readonly");else{var i=e.data.error||e.data||"";i&&c.append('<div class="notice notice-error"><p>'+i+"</p></div>"),n.find(".text").text("Failed!")}}).fail(function(e,t){}).always(function(){})))},_deactivate_license:function(e){e.preventDefault();var n=i(this),o=i(".cartflows-license-popup-open-button"),c=i("#cartflows-license-popup"),s=c.find(".contents");c.find(".license_key").val();c.addClass("validating"),n.find(".text").text("Deactivating.."),s.find(".notice").length&&s.find(".notice").remove(),n.find(".cartflows-processing").addClass("is-active"),i.ajax({url:ajaxurl,type:"POST",data:{action:"cartflows_deactivate_license"}}).done(function(e,t,a){if(c.removeClass("validating"),n.find(".cartflows-processing").removeClass("is-active"),e.success)o.removeClass("inactive").addClass("active").text("Activate License"),n.find(".text").text("Successfully Deactivated! Reloading.."),c.attr("data-license-key",""),setTimeout(function(){location.reload()},2500);else{var i=e.data.message||e.data||e.response||"";i&&s.append('<div class="notice notice-error"><p>'+i+"</p></div>"),n.find(".text").text("Failed!")}}).fail(function(e,t){}).always(function(){})},_getUrlParameter:function(e){var t,a,i=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<i.length;a++)if((t=i[a].split("="))[0]===e)return void 0===t[1]||t[1]}},i(function(){CartFlowsProLicense.init()})}(jQuery);